# 🍽️ Food History Feature - Setup Instructions

## מה התווסף?

הוספנו אפשרות לראות **היסטוריה של כל הארוחות** שהוזמנו במהלך המשחק!

### ✨ תכונות חדשות:

1. **תצוגת היסטוריית ארוחות** - סקציה חדשה בשולחן המשחק
2. **פירוט מלא לכל ארוחה:**
   - מי שילם
   - סכום כולל
   - חלוקה שווה או אישית
   - רשימת כל מי שאכל וכמה כל אחד חייב
   - תאריך ושעה
3. **תצוגה מתקפלת** - לחיצה על "אכלו" מציגה את הפירוט המלא

---

## 🛠️ הוראות התקנה

### שלב 1: הרץ את ה-SQL ב-Supabase

1. פתח את [Supabase Dashboard](https://supabase.com/dashboard)
2. בחר את הפרויקט שלך
3. לחץ על **SQL Editor** בתפריט הצדדי
4. העתק והדבק את כל התוכן מהקובץ `add_food_expenses_table.sql`
5. לחץ **Run** (או Ctrl+Enter)

הסקריפט יוצר:
- טבלה חדשה `food_expenses` לשמירת היסטוריית ארוחות
- אינדקסים לביצועים טובים יותר
- מדיניות RLS (אבטחה) - רק משתתפי השולחן יכולים לראות את הארוחות

### שלב 2: רענן את האפליקציה

פשוט תרענן את הדף (F5) - זהו!

---

## 📖 איך להשתמש?

### 1. הוסף ארוחה (כרגיל)
- לחץ על "היינו רעבים" 🍔🍕
- בחר מי שילם
- הזן סכום ובחר מי אכל
- שמור

### 2. צפה בהיסטוריה
- בשולחן המשחק, מעל "פעילות המשחק"
- תראה "היסטוריית ארוחות 🍽️"
- לחץ על "הצג/הסתר"

### 3. ראה פירוט
- כל ארוחה מוצגת כקלף
- **ראשי:** סכום כולל, תאריך, מי שילם
- **לחץ על "אכלו (X)"** כדי לראות את הפירוט המלא של מי אכל וכמה

---

## 🎨 איך זה נראה?

```
┌─────────────────────────────────────────┐
│ 🍽️ סה"כ: 150₪            שילם: רועי    │
│ 8 דצמ׳, 20:30            חלוקה שווה     │
│                                         │
│ ▸ אכלו (3)  ◀─ לחץ כאן לפירוט         │
└─────────────────────────────────────────┘

לאחר לחיצה:
┌─────────────────────────────────────────┐
│ 🍽️ סה"כ: 150₪            שילם: רועי    │
│ 8 דצמ׳, 20:30            חלוקה שווה     │
│                                         │
│ ▾ אכלו (3)                              │
│   ├─ רועי ................... -50₪     │
│   ├─ דני ..................... -50₪    │
│   └─ עידו .................... -50₪    │
└─────────────────────────────────────────┘
```

---

## 🔄 שינויים טכניים

### טבלה חדשה: `food_expenses`
```sql
- id: UUID (מזהה ייחודי)
- table_id: UUID (השולחן)
- payer_id: UUID (מי שילם)
- total_amount: NUMERIC (סכום כולל)
- split_mode: TEXT ('equal' או 'individual')
- consumers: JSONB (רשימת אוכלים ומחירים)
- created_at: TIMESTAMP (מתי)
- created_by: UUID (מי יצר)
```

### פונקציות חדשות:
1. **`toggleFoodHistory()`** - פותח/סוגר את ההיסטוריה
2. **`loadFoodHistory()`** - טוען ומציג את הארוחות
3. **`submitFood()`** - עודכן לשמור גם ב-`food_expenses`

### תרגומים:
- עברית: "היסטוריית ארוחות", "אכלו", "שילם", "חלוקה שווה", "לפי סועד"
- אנגלית: "Food History", "Consumed by", "Paid by", "Split equally", "Individual amounts"

---

## 🐛 פתרון בעיות

### אם אתה רואה "שגיאה בטעינה":
1. ודא שהרצת את ה-SQL ב-Supabase
2. בדוק ב-Console (F12) אם יש שגיאות RLS
3. אם יש בעיה, הרץ את הסקריפט שוב

### אם לא רואה ארוחות ישנות:
- זה נורמלי! הטבלה החדשה תתחיל לעקוב רק **מהיום**
- ארוחות שהוזנו לפני העדכון לא נשמרו בהיסטוריה

### אם כפתור "הצג/הסתר" לא עובד:
- רענן את הדף (F5)
- נקה את ה-Cache (Ctrl+Shift+R)

---

## ✅ זהו!

עכשיו אתה יכול לעקוב אחרי כל הארוחות במשחק - מי שילם, מי אכל, וכמה כל אחד חייב.

**תהנה!** 🎉
